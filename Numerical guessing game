from random import randint
from math import log, ceil


def is_difficulty_valid(dif):
    if dif.lower() in ['0', '1', '2', '3', '', 'без ограничений попыток',
                              'легкий', 'лёгкий', 'сложный',
                               'без права на ошибку', 'no limit',
                               'no limit on attempts', 'easy', 'hard',
                                'no mistake']:
        return True
    else:
        return False


def can_convert_to_int(num):
    try:
        int(num)
        return True
    except ValueError:
        return False


def is_valid_digit(num, a, b):
    try:
        int(num)
        return a <= int(num) <= b
    except ValueError:
        return False


def is_valid_answer(s):
    if s.isalpha():
        return s.lower() in ['yes', 'y', 'no', 'n', 'да', 'д', 'нет', 'н']
    else:
        return False


def start_game():
    print('Я предлагаю вам сыграть в игру. Я загадаю случайное целое число от' \
    ' a до b, а вы попробуете его угадать.')
    print('Введите целое число a, по умолчанию это будет 1.')
    a = input()
    if a == '':
        a = 1
    else:
        while not can_convert_to_int(a):
            print('Я вас не понимаю, введите пожалуйста целое число a.')
            a = input()
        a = int(a)
    print('Введите целое число b, по умолчанию это будет 100.')
    b = input()
    if b == '':
        b = 100
    else:
        while not can_convert_to_int(b):
            print('Я вас не понимаю, введите пожалуйста целое число b.')
            b = input()
        b = int(b)
    if a > b:
        a, b = b, a
    print(f'Отлично играем в диапазоне от {a} до {b}.')
    target_digit = randint(a, b)
    min_num_attempt = [0, 0, 0, 0]
    min_num_attempt[3] = ceil(log(b - a + 1, 2))
    if min_num_attempt[3] < 1:
        min_num_attempt[3] = 1
    for i in range(2, -1, -1):
        min_num_attempt[i] = min_num_attempt[i + 1] + 2
        if min_num_attempt[i] > b - a:
            min_num_attempt[i] = b - a + 1
    min_num_attempt[0] = min_num_attempt[0] * 100
    print('Выберете уровень сложности, где:')
    print('0 - без ограничений попыток;')
    print(f'1 - лёгкий, {min_num_attempt[1]} попыток;')
    print(f'2 - трудный, {min_num_attempt[2]} попыток,')
    print(f'3 - без права на ошибку, {min_num_attempt[3]} попыток.')
    print('По умолчанию, без ограничения попыток.')
    difficulty = input()
    while not is_difficulty_valid(difficulty):
        print('Я вас не понимаю, выберите пожалуйста уровень сложности.')
        difficulty = input()
    if difficulty.lower() in ['', '0', 'no limit', 'no limit on attempts']:
        max_num_attempt = min_num_attempt[0]
        print('Вы выбрали уровень сложности без ограничений попыток.')
    elif difficulty.lower() in ['1', 'легкий', 'лёгкий', 'easy']:
        max_num_attempt = min_num_attempt[1]
        print(f'Вы выбрали лёгкий уровень сложности. У вас {max_num_attempt} попыток угадать.')
    elif difficulty.lower() in ['2', 'hard', 'сложный']:
        max_num_attempt = min_num_attempt[2]
        print(f'Вы выбрали трудный уровень сложности. У вас {max_num_attempt} попыток угадать.')
    else:
        max_num_attempt = min_num_attempt[3]
        print(f'Вы выбрали уровень сложности без права на ошибку. У вас {max_num_attempt} попыток угадать.')
    return a, b, target_digit, max_num_attempt


def game(a, b, target_digit, max_num_attempt):
    stop_game = False
    list_of_try = []
    count = 0
    while count < max_num_attempt:
        print('Введите ваше число.')
        digit = input()
        if digit.lower() in ['стоп', 'stop', 'конец', 'end',\
                              'enough', 'хватит', 'достаточно']:
            stop_game = True
            win = False
            break
        if digit.lower() in ['какое число', 'какое число?']:
            print(f'Загаданное число было {target_digit}.')
            win = False
            break
        while not is_valid_digit(digit, a, b):
            print(f"А может быть все-таки введем целое число от {a} до {b}?")
            digit = input()
        while digit in list_of_try:
            print(f'Вы уже вводили данное число, попробуйте ввести другое целое число в диапазоне от {a} до {b}.')
            digit = input()
        if int(digit) > target_digit:
            print('Ваше число больше загаданного, попробуйте еще разок.')
            list_of_try.append(digit)
            count += 1
            print(f'У вас осталось {max_num_attempt - count} попыток угадать.')
        elif int(digit) < target_digit:
            print('Ваше число меньше загаданного, попробуйте еще разок.')
            list_of_try.append(digit)
            count += 1
            print(f'У вас осталось {max_num_attempt - count} попыток угадать.')
        else:
            count += 1
            win = True
            break
    else:
        win = False
    return count, win, stop_game
            
        
def end_game(count, win, stop_game):
    if stop_game:
        want_to_play = False
        rematch = False
        return want_to_play, rematch
    elif win:
        print(f'Вы угадали, поздравляю! Вам потребовалось {count} попыток.')
        print('Хотите сыграть ещё раз? (Д/н)')
        answer = input()
        while not is_valid_answer(answer):
            print('Я вас не понимаю, введите пожалуйста ответ в формате да или нет.')
            answer = input()
        if answer.lower() in ['yes', 'y', 'да', 'д']:
            rematch = False
            want_to_play = True
            return want_to_play, rematch
        else:
            rematch = False
            want_to_play = False
            return want_to_play, rematch
    else:
        print('К сожалению вы не смогли угадать загаданное число.')
        print('Хотите взять реванш? (Д/н)')
        answer = input()
        while not is_valid_answer(answer):
            print('Я вас не понимаю, введите пожалуйста ответ в формате да или нет.')
            answer = input()
        if answer.lower() in ['yes', 'y', 'да', 'д']:
            rematch = True
            want_to_play = True
            return want_to_play, rematch
        else:
            print(f'Загаданное число было {target_digit}.')
            print('Хотите сыграть ещё раз? (Д/н)')
            answer = input()
            while not is_valid_answer(answer):
                print('Я вас не понимаю, введите пожалуйста ответ в формате да или нет.')
                answer = input()
            if answer.lower() in ['yes', 'y', 'да', 'д']:
                rematch = False
                want_to_play = True
                return want_to_play, rematch
            else:
                rematch = False
                want_to_play = False
                return want_to_play, rematch


print('Добро пожаловать в числовую угадайку!')
rematch = False
want_to_play = True
while want_to_play:
    if not rematch:
        a, b, target_digit, max_num_attempt = start_game()
    count, win, stop_game = game(a, b, target_digit, max_num_attempt)
    want_to_play, rematch = end_game(count, win, stop_game) 
print('Спасибо, что играли в числовую угадайку. Еще увидимся...')      